import { symbols } from '../../symbols';
import { InvalidSyntaxException } from '../exceptions/InvalidSyntaxException';
import { syntaxAnalysis } from '../syntaxAnalysis';

describe('syntaxAnalysis', () => {
    it('should identify procedure calls', () => {
        const tokensProcedureInConst = [
            { line: 1, id: symbols.program },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.const },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['='] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.procedure },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[':'] },
            { line: 1, id: symbols.integer },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.const },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['='] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.var },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[':'] },
            { line: 1, id: symbols.integer },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.begin },
            { line: 1, id: symbols.writeln },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.literal },
            { line: 1, id: symbols[','] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[':='] },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['+'] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['/'] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols['+'] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols['*'] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.writeln },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.literal },
            { line: 1, id: symbols[','] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.end },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.begin },
            { line: 1, id: symbols.call },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.call },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.end },
            { line: 1, id: symbols['.'] }
        ].reverse();
        expect(() => syntaxAnalysis(tokensProcedureInConst)).not.toThrow();
        expect(tokensProcedureInConst).toEqual([]);

        const tokensProcedureInVar = [
            { line: 1, id: symbols.program },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.const },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['='] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.var },
            { line: 1, id: symbols.procedure },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[':'] },
            { line: 1, id: symbols.integer },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.const },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['='] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.var },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[':'] },
            { line: 1, id: symbols.integer },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.begin },
            { line: 1, id: symbols.writeln },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.literal },
            { line: 1, id: symbols[','] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[':='] },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['+'] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['/'] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols['+'] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols['*'] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.writeln },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.literal },
            { line: 1, id: symbols[','] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.end },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.begin },
            { line: 1, id: symbols.call },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.call },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.end },
            { line: 1, id: symbols['.'] }
        ].reverse();
        expect(() => syntaxAnalysis(tokensProcedureInVar)).toThrow(
            InvalidSyntaxException
        );

        const tokensProcedureInBody = [
            { line: 1, id: symbols.program },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.const },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['='] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.var },
            { line: 1, id: symbols.begin },
            { line: 1, id: symbols.procedure },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[':'] },
            { line: 1, id: symbols.integer },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.const },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['='] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.var },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[':'] },
            { line: 1, id: symbols.integer },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.begin },
            { line: 1, id: symbols.writeln },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.literal },
            { line: 1, id: symbols[','] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[':='] },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['+'] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols['/'] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols['+'] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols['*'] },
            { line: 1, id: symbols.inteiro },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.writeln },
            { line: 1, id: symbols['('] },
            { line: 1, id: symbols.literal },
            { line: 1, id: symbols[','] },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[')'] },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.end },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.call },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.call },
            { line: 1, id: symbols.identificador },
            { line: 1, id: symbols[';'] },
            { line: 1, id: symbols.end },
            { line: 1, id: symbols['.'] }
        ].reverse();
        expect(() => syntaxAnalysis(tokensProcedureInBody)).toThrow(
            InvalidSyntaxException
        );
    });
});
